import{r as d,b as n,B as c,j as e,c as C}from"./index-B7OZzBRK.js";import{T as A,O as E,a as $}from"./TablePlaceholder-CtzLlF3u.js";import{C as k}from"./Toast-C-pLTZpU.js";import{M as D}from"./Modal-BBnWcCLm.js";import{T as P}from"./Table-C0LzT_QR.js";import"./index-DNKZOxsO.js";import"./warning-KWRHVkjh.js";import"./TransitionWrapper-qWTe5h-w.js";import"./ThemeProvider-mjo_KbZQ.js";import"./useEventCallback-DsMNjBTY.js";import"./Placeholder-DGZdzl_d.js";import"./Col-DXoX1HGj.js";import"./Button-5FLJvNMB.js";import"./Button-DQAcu0VB.js";function Q(){document.title="CPMS | Notices";const[f,g]=d.useState(!0),[r,i]=d.useState([]),[t,j]=d.useState({}),[N,h]=d.useState(!1),[y,u]=d.useState(""),[b,m]=d.useState(!1),[w,_]=d.useState(""),v=()=>m(!1),S=s=>e.jsx($,{id:"button-tooltip",...s,children:"Delete Notice"});d.useEffect(()=>{(async()=>{try{const l=localStorage.getItem("token"),a=await n.get(`${c}/user/detail`,{headers:{Authorization:`Bearer ${l}`}});j({role:a.data.role})}catch(l){console.log("Error fetching user details => ",l)}})()},[]),d.useEffect(()=>{t!=null&&t.role&&p()},[t==null?void 0:t.role]);const T=async s=>{_(s),m(!0)},M=async s=>{var l;try{const a=await n.post(`${c}/management/delete-notice?noticeId=${s}`);(l=a==null?void 0:a.data)!=null&&l.msg&&(p(),u(a.data.msg),h(!0))}catch(a){console.log("Error while deleting notice => ",a)}m(!1)},p=async()=>{var s,l;try{const a=await n.get(`${c}/management/get-all-notices`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if((t==null?void 0:t.role)==="tpo_admin"){const x=(s=a==null?void 0:a.data)==null?void 0:s.filter(o=>o.sender_role==="tpo_admin"||o.receiver_role==="tpo_admin");i(x)}else if((t==null?void 0:t.role)==="student"){const x=(l=a==null?void 0:a.data)==null?void 0:l.filter(o=>o.receiver_role==="student");i(x)}else i(a.data)}catch(a){console.log("Error while fetching notices => ",a)}finally{g(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(k,{show:N,onClose:()=>h(!1),message:y,delay:3e3,position:"bottom-end"}),f?e.jsx(A,{}):e.jsx("div",{className:"overflow-hidden rounded-lg shadow-lg border border-gray-200 my-6",children:e.jsxs(P,{hover:!0,responsive:"sm",className:"mb-0 bg-white text-base max-sm:text-sm",children:[e.jsx("thead",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"5%"},children:"#"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"20%"},children:"Title"}),(t==null?void 0:t.role)!=="student"&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"12%"},children:"Sender"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"12%"},children:"Receiver"})]}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"35%"},children:"Message"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"16%"},children:"Posted"}),(t==null?void 0:t.role)!=="student"&&e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-center",style:{width:"10%"},children:"Action"})]})}),e.jsx("tbody",{className:"bg-white",children:(r==null?void 0:r.length)>0?r==null?void 0:r.map((s,l)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-indigo-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:l+1}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs(C,{to:(t==null?void 0:t.role)==="student"?`/student/notice/${s==null?void 0:s._id}`:(t==null?void 0:t.role)==="tpo_admin"?`/tpo/notice/${s==null?void 0:s._id}`:t.role==="management_admin"?`/management/notice/${s==null?void 0:s._id}`:"",className:"no-underline text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-bell text-xs"}),s==null?void 0:s.title,(new Date-new Date(s==null?void 0:s.createdAt))/(1e3*60*60*24)<=2&&e.jsx("span",{className:"inline-flex items-center gap-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs font-bold px-2 py-0.5 rounded-full animate-pulse",children:"NEW"})]})}),(t==null?void 0:t.role)!=="student"&&e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 text-sm",children:[(s==null?void 0:s.sender_role)==="management_admin"&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-semibold",children:[e.jsx("i",{className:"fa-solid fa-user-tie"}),"Management"]}),(s==null?void 0:s.sender_role)==="tpo_admin"&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold",children:[e.jsx("i",{className:"fa-solid fa-user-shield"}),"TPO"]})]}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[(s==null?void 0:s.receiver_role)==="tpo_admin"&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-semibold",children:[e.jsx("i",{className:"fa-solid fa-user-shield"}),"TPO"]}),(s==null?void 0:s.receiver_role)==="student"&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-semibold",children:[e.jsx("i",{className:"fa-solid fa-user-graduate"}),"Student"]})]})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx("i",{className:"fa-solid fa-message text-xs text-gray-400 mt-1"}),e.jsx("span",{className:"line-clamp-2",children:s==null?void 0:s.message})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-regular fa-calendar text-xs text-gray-400"}),new Date(s.createdAt).toLocaleDateString("en-IN")]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx("i",{className:"fa-regular fa-clock text-xs"}),new Date(s.createdAt).toLocaleTimeString("en-IN")]})]})}),(t==null?void 0:t.role)!=="student"&&((t==null?void 0:t.role)==="tpo_admin"&&(s==null?void 0:s.sender_role)!=="management_admin"||(t==null?void 0:t.role)==="management_admin"?e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(E,{placement:"top",delay:{show:250,hide:400},overlay:S,children:e.jsx("button",{className:"p-2 rounded-lg bg-red-50 text-red-600 hover:bg-red-600 hover:text-white transition-all",onClick:()=>T(s._id),children:e.jsx("i",{className:"fa-solid fa-trash-can text-base"})})})})}):e.jsx("td",{className:"px-4 py-3 text-center text-gray-400",children:e.jsx("i",{className:"fa-solid fa-minus"})}))]},s==null?void 0:s._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-bell-slash text-4xl text-gray-300"}),e.jsx("p",{className:"mb-0 font-medium",children:"No Notices Found!"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Check back later for new announcements"})]})})})})]})}),e.jsx(D,{show:b,close:v,header:"Confirmation",body:"Want to delete notice?",btn:"Delete",confirmAction:()=>M(w)})]})}export{Q as default};
