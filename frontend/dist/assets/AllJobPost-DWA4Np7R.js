import{u as R,a as q,r as n,b as g,B as f,j as e}from"./index-B3aSgIEu.js";import{T as V}from"./Table-D7p0oCGX.js";import{P as C}from"./Placeholder-Dt8gjBXH.js";import{T as G,O as N,a as w}from"./TablePlaceholder-BPNYtZh7.js";import{M as H}from"./Modal-y_Bwdyn3.js";import{C as K}from"./Toast-DNXJp6MA.js";import"./ThemeProvider-COntGE-K.js";import"./Col-Cd-x-5D5.js";import"./Button-VxBu_kGs.js";import"./Button-DOHxPqx8.js";import"./index-_BQgUFlf.js";import"./warning-Bnkvw9rZ.js";import"./TransitionWrapper-Bf0TK5bL.js";import"./useEventCallback-BQ8UfDmj.js";function ce(){document.title="CPMS | Job Listings";const u=R(),M=q(),[_,v]=n.useState(!0),[c,k]=n.useState([]),[T,D]=n.useState({}),[x,b]=n.useState(null),[A,d]=n.useState(!1),[E,p]=n.useState(""),[I,y]=n.useState(!1),[J,S]=n.useState(null),[l,L]=n.useState({cmpName:"",jbTitle:""});n.useEffect(()=>{const t=localStorage.getItem("token");g.get(`${f}/user/detail`,{headers:{Authorization:`Bearer ${t}`}}).then(a=>{b({id:a.data.id,email:a.data.email,role:a.data.role}),$()}).catch(a=>{console.log("Error in fetching user details => ",a),p(a.message||"Error loading user data"),d(!0)})},[]);const $=async()=>{var t,a;try{const s=await g.get(`${f}/tpo/jobs`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});k(s.data.data),z(s.data.data)}catch(s){console.log("Error fetching jobs ",s),(a=(t=s==null?void 0:s.response)==null?void 0:t.data)!=null&&a.msg&&(p(s.response.data.msg),d(!0))}},z=async t=>{const a={};for(const s of t)if(s.company&&!a[s.company])try{const i=await g.get(`${f}/company/company-data?companyId=${s.company}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});a[s.company]=i.data.company.companyName}catch(i){console.log("Error fetching company name => ",i)}D(a),v(!1)},B=(t,a,s)=>{S(t),L({cmpName:a,jbTitle:s}),y(!0)},F=async t=>{var a,s,i,h,o,P;try{const r=localStorage.getItem("token"),m=await g.post(`${f}/tpo/delete-job`,{jobId:t},{headers:{Authorization:`Bearer ${r}`}});y(!1),$(),(a=m==null?void 0:m.data)!=null&&a.msg&&(p((s=m==null?void 0:m.data)==null?void 0:s.msg),d(!0))}catch(r){(h=(i=r==null?void 0:r.response)==null?void 0:i.data)!=null&&h.msg&&(p((P=(o=r==null?void 0:r.response)==null?void 0:o.data)==null?void 0:P.msg),d(!0)),console.log("Error deleting job ",r)}},U=()=>{y(!1),S(null)},{showToastPass:j,toastMessagePass:O}=M.state||{showToastPass:!1,toastMessagePass:""};return n.useEffect(()=>{j&&(p(O),d(j),u(".",{replace:!0,state:{}})),c||v(!1)},[]),e.jsxs(e.Fragment,{children:[e.jsx(K,{show:A,onClose:()=>d(!1),message:E,delay:3e3,position:"bottom-end"}),e.jsx("div",{className:"",children:_||!x?e.jsx(G,{}):e.jsx("div",{className:"overflow-hidden rounded-lg shadow-lg border border-gray-200 my-6",children:e.jsxs(V,{hover:!0,responsive:"sm",className:"mb-0 bg-white text-base max-sm:text-sm",children:[e.jsx("thead",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"7%"},children:"Sr. No."}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"20%"},children:"Company"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"20%"},children:"Job Title"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"12%"},children:"CTC"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold",style:{width:"13%"},children:"Deadline"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-center",style:{width:"13%"},children:"Applicants"}),e.jsx("th",{className:"px-4 py-3 text-sm font-semibold text-center",style:{width:"15%"},children:"Action"})]})}),e.jsx("tbody",{className:"bg-white",children:(c==null?void 0:c.length)>0?c==null?void 0:c.map((t,a)=>{var i,h;const s=(i=t==null?void 0:t.applicants)==null?void 0:i.find(o=>o.studentId==x.id);return e.jsxs("tr",{className:`border-b border-gray-100 hover:bg-indigo-50 transition-colors ${s?"bg-green-50":""}`,children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:a+1}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-building text-indigo-600 text-xs"}),e.jsx("span",{className:"font-semibold text-gray-800",children:T[t==null?void 0:t.company]||e.jsx(C,{as:"span",animation:"glow",children:e.jsx(C,{xs:8})})}),s&&e.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 bg-green-100 text-green-700 px-2 py-0.5 rounded-full text-xs font-semibold",children:[e.jsx("i",{className:"fa-solid fa-check"}),"Applied"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-700",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-briefcase text-xs text-gray-400"}),t==null?void 0:t.jobTitle]})}),e.jsx("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-indian-rupee-sign text-xs"}),t==null?void 0:t.salary]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"fa-regular fa-calendar text-xs text-red-500"}),new Date(t==null?void 0:t.applicationDeadline).toLocaleDateString("en-In")]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx("i",{className:"fa-regular fa-clock text-xs"}),new Date(t==null?void 0:t.applicationDeadline).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-center",children:e.jsx("span",{className:"inline-flex items-center justify-center w-10 h-10 bg-purple-100 text-purple-600 rounded-full font-bold",children:((h=t==null?void 0:t.applicants)==null?void 0:h.length)||0})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex justify-center items-center gap-2",children:[e.jsx(N,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(w,{children:"View Details"}),children:e.jsx("button",{className:"p-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-600 hover:text-white transition-all",onClick:()=>{const o={tpo_admin:`../tpo/job/${t._id}`,management_admin:`../management/job/${t._id}`,superuser:`../admin/job/${t._id}`,student:`../student/job/${t._id}`};u(o[x.role])},children:e.jsx("i",{className:"fa-solid fa-eye text-base"})})}),x.role!=="student"&&e.jsxs(e.Fragment,{children:[e.jsx(N,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(w,{children:"Edit Post"}),children:e.jsx("button",{className:"p-2 rounded-lg bg-green-50 text-green-600 hover:bg-green-600 hover:text-white transition-all",onClick:()=>{const o={tpo_admin:`../tpo/post-job/${t._id}`,management_admin:`../management/post-job/${t._id}`,superuser:`../admin/post-job/${t._id}`};u(o[x.role])},children:e.jsx("i",{className:"fa-solid fa-pen-to-square text-base"})})}),e.jsx(N,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(w,{children:"Delete Post"}),children:e.jsx("button",{className:"p-2 rounded-lg bg-red-50 text-red-600 hover:bg-red-600 hover:text-white transition-all",onClick:()=>B(t==null?void 0:t._id,T[t==null?void 0:t.company],t==null?void 0:t.jobTitle),children:e.jsx("i",{className:"fa-solid fa-trash-can text-base"})})})]})]})})]},t==null?void 0:t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-briefcase text-4xl text-gray-300"}),e.jsx("p",{className:"mb-0 font-medium",children:"No Job Posts Found!"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Check back later for new opportunities"})]})})})})]})})}),e.jsx(H,{show:I,close:U,header:`Confirm Delete - ${l==null?void 0:l.cmpName}`,body:`Are you sure you want to delete "${l==null?void 0:l.jbTitle}" from ${l==null?void 0:l.cmpName}? This action cannot be undone.`,btn:"Delete",confirmAction:()=>F(J)})]})}export{ce as default};
