import{u as _,r as l,b as p,B as f,j as e}from"./index-B7OZzBRK.js";import{F as d,a as m}from"./Form-DvNwCsSx.js";import{C as E}from"./Toast-C-pLTZpU.js";import{M as F}from"./Modal-BBnWcCLm.js";import"./ThemeProvider-mjo_KbZQ.js";import"./index-DNKZOxsO.js";import"./warning-KWRHVkjh.js";import"./Col-DXoX1HGj.js";function P(){document.title="CPMS | Send Notice";const i=_(),[j,u]=l.useState(!0),[s,x]=l.useState({}),[h,N]=l.useState(""),[t,b]=l.useState({role:"",id:""}),[v,g]=l.useState(!1),[S,y]=l.useState(""),[w,r]=l.useState(!1),C=()=>r(!1);l.useEffect(()=>{const a=localStorage.getItem("token");if(!a){i("/login");return}p.get(`${f}/user/detail`,{headers:{Authorization:`Bearer ${a}`}}).then(n=>{b({id:n.data.id,role:n.data.role}),u(!1)}).catch(n=>{console.log("SendNotice.jsx => ",n),i("/login")})},[i]);const c=a=>x({...s,[a.target.name]:a.target.value}),M=()=>{if(!(s!=null&&s.receiver_role)&&!(s!=null&&s.title)&&!(s!=null&&s.message)){N("All Fields Required!");return}r(!0)},T=async()=>{var a,n;try{const o=await p.post(`${f}/management/send-notice`,s,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(a=o==null?void 0:o.data)!=null&&a.msg&&(y((n=o==null?void 0:o.data)==null?void 0:n.msg),g(!0)),i((t==null?void 0:t.role)==="management_admin"?"/management/all-notice":"/tpo/all-notice")}catch(o){console.log("Error while sending notice: ",o)}r(!1)};return l.useEffect(()=>{t!=null&&t.role&&(t!=null&&t.id)&&x(a=>({...a,sender:t==null?void 0:t.id,sender_role:t==null?void 0:t.role}))},[t]),e.jsxs(e.Fragment,{children:[e.jsx(E,{show:v,onClose:()=>g(!1),message:S,delay:3e3,position:"bottom-end"}),j?e.jsx("div",{className:"flex justify-center h-72 items-center",children:e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-4xl text-slate-500"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-600 via-gray-600 to-slate-700 text-white rounded-xl shadow-lg p-6 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-white/20 rounded-full",children:e.jsx("i",{className:"fa-solid fa-bell text-3xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Send Notice"}),e.jsx("p",{className:"text-slate-100 text-sm mt-1",children:"Send important notifications to students or TPO"})]})]})}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"bg-white/95 border-2 border-slate-200 rounded-xl shadow-lg p-8 max-sm:p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-envelope text-slate-600 text-xl"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800",children:"Notice Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[(t==null?void 0:t.role)==="management_admin"&&e.jsx(d,{controlId:"floatingSendTo",label:e.jsxs("span",{children:["Receiver Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),children:e.jsxs(m.Select,{"aria-label":"Floating label select send to",className:"cursor-pointer",name:"receiver_role",value:(s==null?void 0:s.receiver_role)||"",onChange:c,children:[e.jsx("option",{disabled:!0,value:"",className:"text-gray-400",children:"Select Receiver Role..."}),e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"tpo_admin",children:"TPO"})]})}),e.jsx(d,{controlId:"floatingTitle",label:e.jsxs("span",{children:["Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),className:(t==null?void 0:t.role)==="tpo_admin"?"col-span-2":"",children:e.jsx(m.Control,{type:"text",placeholder:"Title",name:"title",value:(s==null?void 0:s.title)||"",onChange:c})}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{controlId:"floatingMessage",label:e.jsxs("span",{children:["Message ",e.jsx("span",{style:{color:"red"},children:"*"})]}),children:e.jsx(m.Control,{as:"textarea",placeholder:"Message",name:"message",style:{maxHeight:"250px",height:"200px"},value:(s==null?void 0:s.message)||"",onChange:c})})})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-center text-red-500",children:h&&h})})]}),e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-6",children:[e.jsxs("button",{type:"button",onClick:M,className:"px-8 py-3 bg-gradient-to-r from-slate-600 to-gray-600 text-white font-semibold rounded-lg shadow-md hover:shadow-lg hover:scale-105 transition-all duration-300 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-paper-plane"}),"Send Notice"]}),e.jsxs("button",{type:"button",onClick:()=>i(-1),className:"px-8 py-3 bg-slate-200 text-slate-700 font-semibold rounded-lg shadow hover:bg-slate-300 transition-colors duration-300 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-xmark"}),"Cancel"]})]})]})]}),e.jsx(F,{show:w,close:C,header:"Confirmation",body:`Sending Notice ${s!=null&&s.message?`"${s==null?void 0:s.message}"`:""} to ${(s==null?void 0:s.receiver_role)||"student"}?`,btn:"Send",confirmAction:T})]})}export{P as default};
