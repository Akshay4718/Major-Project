import{d as z,r as d,b,B as C,j as e}from"./index-B7OZzBRK.js";import{C as O}from"./Toast-C-pLTZpU.js";function ae(){var A,$,G;document.title="CPMS | Manage Applicants";const{jobId:h}=z(),[n,L]=d.useState(null),[v,F]=d.useState([]),[f,k]=d.useState({}),[U,I]=d.useState(!0),[E,m]=d.useState(!1),[M,u]=d.useState(""),[J,q]=d.useState([]),[V,W]=d.useState([]),[g,T]=d.useState("all"),[H,K]=d.useState({}),[X,Y]=d.useState(!1),[Z,ee]=d.useState(null),[y,P]=d.useState(""),[a,p]=d.useState({minCGPA:"",maxCGPA:"",minSSLC:"",maxSSLC:"",minPUC:"",maxPUC:""});d.useEffect(()=>{N()},[h]);const N=async()=>{try{const t=localStorage.getItem("token"),l=await b.get(`${C}/placement-workflow/status/${h}`,{headers:{Authorization:`Bearer ${t}`}});l.data.success&&(L(l.data.job),F(l.data.applicants),k(l.data.stats))}catch(t){console.error("Error fetching workflow status:",t),u("Failed to load applicants"),m(!0)}finally{I(!1)}},_=async()=>{try{const t=localStorage.getItem("token"),l=g!=="all"?`?status=${g}`:"",s=await b.get(`${C}/placement-workflow/export/${h}${l}`,{headers:{Authorization:`Bearer ${t}`},responseType:"blob"}),o=window.URL.createObjectURL(new Blob([s.data])),r=document.createElement("a");r.href=o;const c=g!=="all"?g.charAt(0).toUpperCase()+g.slice(1):"All";r.setAttribute("download",`${c}_Students_${n==null?void 0:n.jobTitle}_${Date.now()}.xlsx`),document.body.appendChild(r),r.click(),r.remove();const i=j().length;u(`Excel file downloaded successfully! (${i} ${c} student${i!==1?"s":""})`),m(!0),N()}catch(t){console.error("Error exporting to Excel:",t),u("Failed to export Excel file"),m(!0)}},B=async()=>{var t,l;if(window.confirm("Are you sure you want to finish this drive? This will lock the job and no further changes can be made."))try{const s=localStorage.getItem("token"),o=await b.post(`${C}/placement-workflow/finish-drive/${h}`,{},{headers:{Authorization:`Bearer ${s}`}});u(o.data.message),m(!0),N()}catch(s){console.error("Error finishing drive:",s),u(((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to finish drive"),m(!0)}},D=async(t,l)=>{var s,o;if(n!=null&&n.driveFinished){u("Cannot modify applicants - Drive is finished"),m(!0);return}try{const r=localStorage.getItem("token");let c=[],i=[];if(l==="shortlisted")c=[t];else if(l==="rejected")i=[t];else if(l==="in-process"||l==="placed"){const S=await b.post(`${C}/student/update-status/${h}/${t}`,{applicant:{applicationStatus:l}},{headers:{Authorization:`Bearer ${r}`}});u(`Status updated to ${l}`),m(!0),N();return}const x=await b.post(`${C}/placement-workflow/shortlist/${h}`,{shortlistedStudentIds:c,rejectedStudentIds:i},{headers:{Authorization:`Bearer ${r}`}});u(x.data.message),m(!0),N()}catch(r){console.error("Error updating status:",r),u(((o=(s=r.response)==null?void 0:s.data)==null?void 0:o.message)||"Failed to update status"),m(!0)}},w=t=>{if(!t)return null;const l=[t.sem1,t.sem2,t.sem3,t.sem4,t.sem5,t.sem6,t.sem7,t.sem8].filter(s=>s!=null&&s!==""&&!isNaN(s));return l.length>0?l.reduce((s,o)=>s+parseFloat(o),0)/l.length:null},j=()=>{let t=v;if(g!=="all"&&(t=t.filter(l=>l.applicationStatus===g)),y.trim()){const l=y.toLowerCase();t=t.filter(s=>{var i,x;const o=`${s.studentId.first_name} ${s.studentId.last_name}`.toLowerCase(),r=s.studentId.email.toLowerCase(),c=((x=(i=s.studentId.studentProfile)==null?void 0:i.USN)==null?void 0:x.toLowerCase())||"";return o.includes(l)||r.includes(l)||c.includes(l)})}return(a.minCGPA||a.maxCGPA)&&(console.log("ðŸ” CGPA Filter Active:",{minCGPA:a.minCGPA,maxCGPA:a.maxCGPA}),t=t.filter(l=>{var x,S;const s=w((x=l.studentId.studentProfile)==null?void 0:x.SGPA),o=`${l.studentId.first_name} ${l.studentId.last_name}`;if(console.log(`Student: ${o}, CGPA: ${s!==null?s.toFixed(2):"NO DATA"}, SGPA:`,(S=l.studentId.studentProfile)==null?void 0:S.SGPA),s===null)return console.log("  âŒ Filtered out (no CGPA data)"),!1;const r=a.minCGPA?parseFloat(a.minCGPA):0,c=a.maxCGPA?parseFloat(a.maxCGPA):10,i=s>=r&&s<=c;return console.log(`  ${i?"âœ…":"âŒ"} CGPA ${s.toFixed(2)} ${i?"passes":"fails"} filter (${r}-${c})`),i}),console.log(`ðŸ“Š After CGPA filter: ${t.length} students remaining`)),(a.minSSLC||a.maxSSLC)&&(t=t.filter(l=>{var c,i,x;const s=(x=(i=(c=l.studentId.studentProfile)==null?void 0:c.pastQualification)==null?void 0:i.sslc)==null?void 0:x.percentage;if(!s&&s!==0)return!1;const o=a.minSSLC?parseFloat(a.minSSLC):0,r=a.maxSSLC?parseFloat(a.maxSSLC):100;return s>=o&&s<=r})),(a.minPUC||a.maxPUC)&&(t=t.filter(l=>{var c,i,x;const s=(x=(i=(c=l.studentId.studentProfile)==null?void 0:c.pastQualification)==null?void 0:i.puc)==null?void 0:x.percentage;if(!s&&s!==0)return!1;const o=a.minPUC?parseFloat(a.minPUC):0,r=a.maxPUC?parseFloat(a.maxPUC):100;return s>=o&&s<=r})),t},R=()=>{p({minCGPA:"",maxCGPA:"",minSSLC:"",maxSSLC:"",minPUC:"",maxPUC:""})},Q=t=>{const l={shortlisted:{bg:"bg-yellow-100",text:"text-yellow-700",icon:"fa-list-check",label:"Shortlisted"},"in-process":{bg:"bg-orange-100",text:"text-orange-700",icon:"fa-spinner",label:"In Process"},placed:{bg:"bg-green-100",text:"text-green-700",icon:"fa-circle-check",label:"Placed"},rejected:{bg:"bg-red-100",text:"text-red-700",icon:"fa-circle-xmark",label:"Rejected"}},s=l[t]||l.shortlisted;return e.jsxs("span",{className:`inline-flex items-center gap-1 ${s.bg} ${s.text} px-3 py-1 rounded-full text-xs font-semibold`,children:[e.jsx("i",{className:`fa-solid ${s.icon}`}),s.label]})};return U?e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-4xl text-indigo-600"})}):e.jsxs(e.Fragment,{children:[e.jsx(O,{show:E,onClose:()=>m(!1),message:M,delay:3e3,position:"bottom-end"}),e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 flex-wrap gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:(n==null?void 0:n.jobTitle)||"Job Details"}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Company:"})," ",((A=n==null?void 0:n.company)==null?void 0:A.companyName)||"N/A",(($=n==null?void 0:n.company)==null?void 0:$.companyLocation)&&e.jsxs("span",{className:"ml-2 text-sm",children:[e.jsx("i",{className:"fa-solid fa-location-dot"})," ",(G=n==null?void 0:n.company)==null?void 0:G.companyLocation]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!(n!=null&&n.driveFinished)&&e.jsxs("button",{onClick:B,className:"flex items-center gap-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-all shadow-md hover:shadow-lg",children:[e.jsx("i",{className:"fa-solid fa-flag-checkered"}),"Finish Drive"]}),(n==null?void 0:n.driveFinished)&&e.jsxs("div",{className:"flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-lg border border-green-300",children:[e.jsx("i",{className:"fa-solid fa-check-circle"}),"Drive Finished"]}),e.jsxs("button",{onClick:_,className:"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx("i",{className:"fa-solid fa-file-excel"}),"Export to Excel"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:f.total||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:f.shortlisted||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Shortlisted"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:f.inProcess||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"In Process"})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.placed||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Placed"})]}),e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:f.rejected||0}),e.jsx("div",{className:"text-xs text-gray-600",children:"Rejected"})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-4",children:e.jsx("div",{className:"flex gap-2 p-2 overflow-x-auto",children:["all","shortlisted","in-process","placed","rejected"].map(t=>e.jsx("button",{onClick:()=>T(t),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${g===t?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:t.charAt(0).toUpperCase()+t.slice(1)},t))})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("i",{className:"fa-solid fa-magnifying-glass text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search by name, email, or USN...",value:y,onChange:t=>P(t.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"}),y&&e.jsx("button",{onClick:()=>P(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("i",{className:"fa-solid fa-xmark text-gray-400 hover:text-gray-600"})})]}),y&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Found ",j().length," result(s)"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-filter text-indigo-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Academic Filters"})]}),(a.minCGPA||a.maxCGPA||a.minSSLC||a.maxSSLC||a.minPUC||a.maxPUC)&&e.jsxs("button",{onClick:R,className:"text-sm text-indigo-600 hover:text-indigo-800 font-medium flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-rotate-left"}),"Clear Filters"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e.jsx("i",{className:"fa-solid fa-graduation-cap text-indigo-600 mr-1"}),"CGPA (0-10)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"Min",min:"0",max:"10",step:"0.1",value:a.minCGPA,onChange:t=>p({...a,minCGPA:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"}),e.jsx("span",{className:"flex items-center text-gray-500",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",min:"0",max:"10",step:"0.1",value:a.maxCGPA,onChange:t=>p({...a,maxCGPA:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e.jsx("i",{className:"fa-solid fa-school text-green-600 mr-1"}),"SSLC / 10th (%)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"Min",min:"0",max:"100",step:"0.01",value:a.minSSLC,onChange:t=>p({...a,minSSLC:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"}),e.jsx("span",{className:"flex items-center text-gray-500",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",min:"0",max:"100",step:"0.01",value:a.maxSSLC,onChange:t=>p({...a,maxSSLC:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e.jsx("i",{className:"fa-solid fa-book text-blue-600 mr-1"}),"PUC / 12th (%)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"Min",min:"0",max:"100",step:"0.01",value:a.minPUC,onChange:t=>p({...a,minPUC:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"}),e.jsx("span",{className:"flex items-center text-gray-500",children:"-"}),e.jsx("input",{type:"number",placeholder:"Max",min:"0",max:"100",step:"0.01",value:a.maxPUC,onChange:t=>p({...a,maxPUC:t.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-sm"})]})]})]}),(a.minCGPA||a.maxCGPA||a.minSSLC||a.maxSSLC||a.minPUC||a.maxPUC)&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600 font-medium",children:"Active Filters:"}),(a.minCGPA||a.maxCGPA)&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-xs",children:["CGPA: ",a.minCGPA||"0"," - ",a.maxCGPA||"10"]}),(a.minSSLC||a.maxSSLC)&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs",children:["SSLC: ",a.minSSLC||"0","% - ",a.maxSSLC||"100","%"]}),(a.minPUC||a.maxPUC)&&e.jsxs("span",{className:"inline-flex items-center gap-1 bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs",children:["PUC: ",a.minPUC||"0","% - ",a.maxPUC||"100","%"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["â†’ Showing ",j().length," of ",v.length," applicants"]})]})})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"S.No"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"CGPA"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"SSLC %"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"PUC %"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Current Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Applied On"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold",children:"Change Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j().length>0?j().map((t,l)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:l+1}),e.jsxs("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:[t.studentId.first_name," ",t.studentId.last_name]}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:t.studentId.email}),e.jsx("td",{className:"px-4 py-3 text-center",children:(()=>{var r;const s=w((r=t.studentId.studentProfile)==null?void 0:r.SGPA);if(s===null)return e.jsx("span",{className:"text-xs text-gray-400 italic",children:"N/A"});const o=s>=8?"text-green-600":s>=7?"text-blue-600":s>=6?"text-yellow-600":"text-orange-600";return e.jsx("span",{className:`text-sm font-semibold ${o}`,children:s.toFixed(2)})})()}),e.jsx("td",{className:"px-4 py-3 text-center",children:(()=>{var r,c,i;const s=(i=(c=(r=t.studentId.studentProfile)==null?void 0:r.pastQualification)==null?void 0:c.sslc)==null?void 0:i.percentage;if(!s&&s!==0)return e.jsx("span",{className:"text-xs text-gray-400 italic",children:"N/A"});const o=s>=85?"text-green-600":s>=70?"text-blue-600":s>=60?"text-yellow-600":"text-orange-600";return e.jsxs("span",{className:`text-sm font-semibold ${o}`,children:[s,"%"]})})()}),e.jsx("td",{className:"px-4 py-3 text-center",children:(()=>{var r,c,i;const s=(i=(c=(r=t.studentId.studentProfile)==null?void 0:r.pastQualification)==null?void 0:c.puc)==null?void 0:i.percentage;if(!s&&s!==0)return e.jsx("span",{className:"text-xs text-gray-400 italic",children:"N/A"});const o=s>=85?"text-green-600":s>=70?"text-blue-600":s>=60?"text-yellow-600":"text-orange-600";return e.jsxs("span",{className:`text-sm font-semibold ${o}`,children:[s,"%"]})})()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:Q(t.applicationStatus)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:new Date(t.appliedAt).toLocaleDateString("en-IN")}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("select",{value:t.applicationStatus,onChange:s=>D(t.studentId._id,s.target.value),disabled:n==null?void 0:n.driveFinished,className:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 ${n!=null&&n.driveFinished?"bg-gray-100 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"shortlisted",children:"Shortlisted"}),e.jsx("option",{value:"in-process",children:"In Process"}),e.jsx("option",{value:"placed",children:"Placed"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})})]},t.studentId._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-4 py-8 text-center text-gray-500",children:"No applicants found"})})})]})})})]})]})}export{ae as default};
